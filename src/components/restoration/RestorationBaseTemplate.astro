---
// src/components/restoration/RestorationBaseTemplate.astro
// Reusable base template for all restoration services
// Consolidates common sections to eliminate duplication

import "@fortawesome/fontawesome-free/css/all.min.css";
import FAQ from "../AcordeonServices";
import RestorationCTA from "../RestorationCTA";
import ServiceAreas from "../ServiceAreas.astro";
import { cities } from "../../data/restoration.js";
import { getAltText } from "../../data/image-alt-texts.js";
import ServiceCard from "../ServiceCard.astro";

export interface Props {
    content: {
        hero: {
            title: string;
            titleFallback?: string;
            description: string;
            cta: string;
            ctaSecondary?: string;
            bgImage: string;
            pricing?: {
                min: number;
                max: number;
                average: number;
                unit: string;
                disclaimer?: string;
            };
            responseTime?: string;
            availability?: string;
            certifications?: string[];
        };
        services: Array<{
            icon: string;
            title: string;
            description: string;
            image: string;
            link: string;
            slug?: string;
            ctaText?: string;
            features?: string[];
        }>;
        faqs: Array<{
            q: string;
            a: string;
        }>;
        steps: Array<{
            title: string;
            text: string;
            icon: string;
        }>;
    };
    type: "water" | "fire" | "mold" | "storm" | "mitigation" | "general";
    group: any;
    sub: any;
    city?: {
        nombre: string;
        slug: string;
    };
}

const { content, type, group, sub, city } = Astro.props;

// Dynamic H1 with city optimization
const getHeroTitle = () => {
    if (city && content.hero.title.includes("{city}")) {
        return content.hero.title.replace("{city}", city.nombre);
    }
    return (
        content.hero.titleFallback ||
        content.hero.title.replace(" in {city}", "")
    );
};

const heroTitle = getHeroTitle();
const serviceName = sub?.title || group.name;

// Dynamic city grid for Level 4 distribution
const getCitiesByRegion = () => {
    const regions = {};
    cities.forEach((city) => {
        if (!regions[city.region]) {
            regions[city.region] = [];
        }
        regions[city.region].push(city);
    });
    return regions;
};

const cityRegions = getCitiesByRegion();
const faqCategory = `${type}-${sub?.slug || group.slug}`;

// Get service name for display (already declared above)
---

<!-- Hero Section -->
<section
    class="hero-section"
    style={`background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url(${content.hero.bgImage})`}
    role="img"
    aria-label={getAltText(content.hero.bgImage)}
>
    <div class="hero-overlay"></div>
    <div class="hero-content">
        {
            content.hero.certifications && (
                <div class="hero-trust-badges">
                    {content.hero.certifications.map((cert) => (
                        <span class="trust-badge">
                            <i class="fas fa-check-circle" /> {cert}
                        </span>
                    ))}
                </div>
            )
        }

        <h1>{heroTitle}</h1>
        <p>{content.hero.description}</p>

        {
            content.hero.pricing && (
                <div class="hero-metrics">
                    <div class="metric-item">
                        <span class="metric-label">Avg. Cost</span>
                        <span class="metric-value">
                            ${content.hero.pricing.min.toLocaleString()} - $
                            {content.hero.pricing.max.toLocaleString()}
                        </span>
                        <span class="metric-sub">
                            {content.hero.pricing.disclaimer}
                        </span>
                    </div>
                    <div class="metric-divider" />
                    <div class="metric-item">
                        <span class="metric-label">Response Time</span>
                        <span class="metric-value">
                            {content.hero.responseTime}
                        </span>
                        <span class="metric-sub">Live 24/7 Dispatch</span>
                    </div>
                </div>
            )
        }

        <div class="hero-actions">
            <a href="tel:7866022217" class="cta-button primary">
                <i class="fas fa-phone-alt"></i>
                {content.hero.cta}
            </a>
            {
                content.hero.ctaSecondary && (
                    <a href="/contact" class="cta-button secondary">
                        {content.hero.ctaSecondary}
                    </a>
                )
            }
        </div>
    </div>
</section>

<style>
    .hero-section {
        position: relative;
        min-height: 80vh;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        background-size: cover;
        background-position: center;
        color: white;
        padding: 4rem 1rem;
    }

    .hero-content {
        position: relative;
        z-index: 2;
        max-width: 900px;
        margin: 0 auto;
    }

    .hero-trust-badges {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }

    .trust-badge {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(4px);
        padding: 0.4rem 1rem;
        border-radius: 50px;
        font-size: 0.9rem;
        font-weight: 600;
        letter-spacing: 0.5px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        text-transform: uppercase;
    }

    .hero-content h1 {
        font-size: 3.5rem;
        font-weight: 800;
        line-height: 1.1;
        margin-bottom: 1.5rem;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }

    .hero-content p {
        font-size: 1.25rem;
        margin-bottom: 2.5rem;
        opacity: 0.9;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
    }

    .hero-metrics {
        display: inline-flex;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2.5rem;
        gap: 2rem;
        align-items: center;
    }

    .metric-item {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .metric-label {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        opacity: 0.8;
        margin-bottom: 0.25rem;
    }

    .metric-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #35c3e9;
    }

    .metric-sub {
        font-size: 0.75rem;
        opacity: 0.7;
        margin-top: 0.25rem;
    }

    .metric-divider {
        width: 1px;
        height: 40px;
        background: rgba(255, 255, 255, 0.2);
    }

    .hero-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .cta-button {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 1rem 2rem;
        border-radius: 8px;
        font-weight: 700;
        text-decoration: none;
        transition: all 0.3s ease;
        font-size: 1.1rem;
    }

    .cta-button.primary {
        background: #35c3e9;
        color: #0f172a;
        border: 2px solid #35c3e9;
    }

    .cta-button.primary:hover {
        background: #22a7c9;
        border-color: #22a7c9;
        transform: translateY(-2px);
    }

    .cta-button.secondary {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(4px);
    }

    .cta-button.secondary:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: white;
        transform: translateY(-2px);
    }

    @media (max-width: 768px) {
        .hero-content h1 {
            font-size: 2.5rem;
        }

        .hero-metrics {
            flex-direction: column;
            gap: 1.5rem;
            width: 100%;
            padding: 1rem;
        }

        .metric-divider {
            width: 100%;
            height: 1px;
        }

        .hero-actions {
            flex-direction: column;
            width: 100%;
        }

        .cta-button {
            width: 100%;
            justify-content: center;
        }
    }

    .solution-card-wrapper {
        height: 100%;
    }
</style>

<!-- Services Grid -->
<section>
    <div class="services-grid">
        {
            content.services.map((service) => (
                <a href={service.link} class="service-item-clickable">
                    <i class={service.icon} />
                    <h3>{service.title}</h3>
                </a>
            ))
        }
    </div>
</section>

<!-- Solutions Cards -->
<section class="solutions-section">
    <div class="container">
        <h2 class="solutions-title">Comprehensive {serviceName} Solutions</h2>
        <div class="solutions-grid">
            {
                content.services.map((service, index) => (
                    <div class="solution-card-wrapper">
                        <ServiceCard
                            title={service.title}
                            description={service.description}
                            icon={service.icon || "fas fa-tools"}
                            ctaLink={`/restoration/${type}/${service.slug}`}
                            imageUrl={service.image}
                            ctaText={service.ctaText}
                            features={service.features}
                        />
                    </div>
                ))
            }
        </div>
    </div>
</section>

<!-- Process Steps -->
<section class="steps-section">
    <h2 class="steps-title">How It Works</h2>
    <div class="steps-container">
        {
            content.steps.map((step, index) => (
                <div class="step-item" data-step={index + 1}>
                    <div class="step-icon">
                        <i class={step.icon} />
                    </div>
                    <h3>{step.title}</h3>
                    <p>{step.text}</p>
                </div>
            ))
        }
    </div>
</section>

<!-- Content Deep Section: Understanding the Service -->
<section class="section content-deep">
    <div class="container">
        <h2>Understanding {serviceName}</h2>
        <div class="content-grid">
            <div class="content-main">
                <div class="content-block">
                    <h3>Warning Signs of {serviceName}</h3>
                    <p>
                        Recognizing {serviceName.toLowerCase()} early is crucial
                        for preventing extensive property damage. Look for water
                        stains on ceilings or walls, musty odors that indicate hidden
                        moisture, warped flooring or baseboards, and unexplained
                        increases in your water bill. In Florida's humid climate,
                        even small leaks can quickly escalate into major restoration
                        projects.
                    </p>
                    <ul class="warning-signs">
                        <li>
                            <i class="fas fa-eye"></i> Visible water stains or discoloration
                        </li>
                        <li>
                            <i class="fas fa-nose"></i> Musty or moldy odors
                        </li>
                        <li>
                            <i class="fas fa-home"></i> Warped floors, walls, or
                            ceilings
                        </li>
                        <li>
                            <i class="fas fa-dollar-sign"></i> Unexplained water
                            bill increases
                        </li>
                        <li>
                            <i class="fas fa-thermometer-half"></i> Increased humidity
                            levels indoors
                        </li>
                    </ul>
                </div>

                <div class="content-block">
                    <h3>Our Detailed {serviceName} Restoration Process</h3>
                    <p>
                        Our certified technicians follow IICRC standards for {
                            serviceName.toLowerCase()
                        } restoration. We begin with moisture mapping using thermal
                        imaging to identify all affected areas, including hidden
                        damage. Our industrial-grade equipment removes standing water
                        and moisture from building materials, preventing secondary
                        damage like mold growth.
                    </p>
                    <div class="process-detailed">
                        {
                            content.steps.map((step, index) => (
                                <div class="process-step-detailed">
                                    <div class="step-number">{index + 1}</div>
                                    <div class="step-content">
                                        <h4>{step.title}</h4>
                                        <p>{step.text}</p>
                                    </div>
                                </div>
                            ))
                        }
                    </div>
                </div>
            </div>

            <div class="content-sidebar">
                <div class="trust-indicators">
                    <h3>Why Choose Paramount Property Restoration?</h3>
                    <ul class="trust-list">
                        <li>
                            <i class="fas fa-certificate"></i> IICRC Certified Technicians
                        </li>
                        <li>
                            <i class="fas fa-shield-alt"></i> Licensed & Insured
                            in Florida
                        </li>
                        <li>
                            <i class="fas fa-clock"></i> 24/7 Emergency Response
                        </li>
                        <li>
                            <i class="fas fa-handshake"></i> Direct Insurance Billing
                        </li>
                        <li>
                            <i class="fas fa-star"></i> 4.9★ Customer Rating
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Insurance Assistance Section -->
<section class="section bg-secondary insurance-help">
    <div class="container">
        <h2>Insurance Claims Assistance for {serviceName}</h2>
        <div class="insurance-grid">
            <div class="insurance-content">
                <p>
                    Dealing with insurance claims for {
                        serviceName.toLowerCase()
                    } can be overwhelming. Our team acts as your advocate throughout
                    the entire claims process, ensuring you receive maximum coverage
                    for your restoration needs. We document everything thoroughly,
                    communicate directly with adjusters, and handle all paperwork
                    to streamline your claim.
                </p>

                <div class="insurance-benefits">
                    <div class="benefit-item">
                        <i class="fas fa-camera"></i>
                        <h4>Professional Documentation</h4>
                        <p>
                            Detailed photos, moisture readings, and damage
                            reports for your claim
                        </p>
                    </div>
                    <div class="benefit-item">
                        <i class="fas fa-handshake"></i>
                        <h4>Adjuster Coordination</h4>
                        <p>
                            We meet with insurance adjusters and provide expert
                            testimony
                        </p>
                    </div>
                    <div class="benefit-item">
                        <i class="fas fa-dollar-sign"></i>
                        <h4>Maximize Coverage</h4>
                        <p>
                            Our experience helps ensure you receive the full
                            compensation you deserve
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- FAQ Section -->
<section>
    <FAQ
        client:load
        category={faqCategory}
        customQuestions={content.faqs.map((faq, index) => ({
            id: `${faqCategory}-${index}`,
            question: faq.q,
            answer: faq.a,
        }))}
        title="Frequently Asked Questions"
    />
</section>

<!-- Service Areas - Critical for SEO Internal Linking -->
{
    (() => {
        // Default subservices for city linking when on a main service hub page
        const defaultSubservices = {
            water: "flood-damage",
            fire: "fire-damage-repair",
            mold: "mold-damage-restoration",
            storm: "emergency-storm-repair",
            mitigation: "water-mitigation",
        };

        const targetSubSlug = sub?.slug || defaultSubservices[type];

        return (
            <ServiceAreas
                serviceSlug={group.slug}
                serviceName={`${serviceName} Restoration`}
                subserviceSlug={targetSubSlug}
                vertical="restoration"
            />
        );
    })()
}

<!-- Final CTA -->
<RestorationCTA
    client:load
    title={`Don't let ${type} damage linger.`}
    subtitle="Schedule your free assessment now—restoration starts immediately."
    buttonText={`Free ${serviceName} Assessment`}
    buttonLink="/contact"
/>
