---
import { cities } from "../../../data/restoration.js";
import FAQ from "../../AcordeonServices";
import RestorationCTA from "../../RestorationCTA";
// Importar el CSS limpio
import "../../../styles/pages/restoration-responsive.css";

const { group, sub } = Astro.props;

// Usar datos del CMS o fallbacks inteligentes
const overviewData = sub.overview || {
  heading: `Professional ${sub.title} Services`,
  content: `${sub.title} requires immediate professional attention to prevent extensive property damage and health risks. Our certified technicians provide comprehensive solutions across Florida with advanced equipment and proven methods.`, // Fallback
};

// Fallback for Quick Steps if not provided in data
const quickSteps = sub.quickSteps || [
  { title: "Call 24/7", desc: "Immediate Dispatch" },
  { title: "Free Assessment", desc: "We Inspect & Locate" },
  { title: "Direct Billing", desc: "We Handle Insurance" },
];

const serviceFeatures = sub.features || [
  {
    icon: "fas fa-tint",
    title: "Emergency Water Extraction",
    description: "Pumps and vacuums remove large volumes of water quickly.",
  },
];

// City data for regional display
const getCitiesByRegion = () => {
  const regions = {};
  cities.forEach((city) => {
    if (!regions[city.region]) {
      regions[city.region] = [];
    }
    regions[city.region].push(city);
  });
  return regions;
};

const cityRegions = getCitiesByRegion();
---

<div class="unified-service-template">
  <section
    class="hero-section"
    style={`background-image: url('${sub.hero?.image || "/images/herowater.webp"}');`}
  >
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <div class="hero-badge">
        <i class="fas fa-clock"></i> 24/7 Emergency Response
      </div>
      <h1>{sub.hero?.title || `${sub.title} Experts in Florida`}</h1>
      <p>{sub.hero?.description}</p>
      <div class="hero-actions">
        <a href="tel:+17866022217" class="cta-button primary">
          <i class="fas fa-bolt"></i> Call Now: (786) 602-2217
        </a>
      </div>
    </div>
  </section>

  <!-- QUICK RELIEF BAR (New) -->
  <section class="quick-relief-bar">
    <div class="container">
      <div class="relief-grid">
        {
          quickSteps.map((step, index) => (
            <div class="relief-step">
              <span class="step-num">0{index + 1}</span>
              <div class="step-info">
                <strong>{step.title}</strong>
                <p>{step.desc}</p>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Overview Section (Moved Up) -->
  <section class="section service-overview">
    <div class="container">
      <div class="overview-grid">
        <div class="overview-content">
          <h2>{overviewData.heading}</h2>
          <p class="overview-text">{overviewData.content}</p>

          <div class="diagnostic-section">
            <h3>
              <i class="fas fa-check-circle" style="color: #35c3e9;"></i> Why Choose
              Us
            </h3>
            <ul class="service-features">
              <li>
                <span class="feature-icon">#</span> IICRC Certified Technicians
              </li>
              <li>
                <span class="feature-icon">#</span> Advanced Moisture Detection
              </li>
              <li>
                <span class="feature-icon">#</span> Direct Insurance Billing
              </li>
              <li>
                <span class="feature-icon">#</span> 60-Minute Response Time
              </li>
            </ul>
          </div>
        </div>

        <div class="overview-sidebar">
          <h3><i class="fas fa-clipboard-list"></i> Our Process</h3>
          {
            sub.technicalSpecs?.deliverables?.slice(0, 4).map((step, index) => (
              <div class="process-step">
                <div class="step-number">{index + 1}</div>
                <div class="step-content">
                  <p>{step}</p>
                </div>
              </div>
            )) || (
              <p>
                We follow a strict IICRC protocol to ensure your property is
                restored safely and efficiently.
              </p>
            )
          }

          <div class="insurance-help-compact">
            <h4>
              <i class="fas fa-handshake" style="color: #35c3e9;"></i> We Bill Insurance
              Direct
            </h4>
            <p>
              We work with all major carriers to ensure your claim is handled
              correctly.
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Services Grid (Trust Signals - Moved Down) -->
  <section class="section">
    <div class="container">
      <h2 class="section-title-center">
        Comprehensive Restoration Capabilities
      </h2>
      <div class="services-grid">
        {
          serviceFeatures.map((feature) => (
            <div class="service-item">
              <i class={feature.icon} />
              <h3>{feature.title}</h3>
              <p>{feature.description}</p>
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Cities Section -->
  <section class="section" style="padding-bottom: 2rem; background: #f8f9fa;">
    <div class="container">
      <h2 class="section-title">
        Immediate {sub.title} Service Available Throughout Florida
      </h2>

      <!-- Regional Accordion for All Cities -->
      <div class="regional-accordion" style="margin-top: 3rem;">
        <div style="text-align: center; margin-bottom: 2rem;">
          <h3 style="color: #333; margin-bottom: 0.5rem;">
            All Florida Service Areas
          </h3>
          <p style="color: #666;">
            Click on any region to see all available cities
          </p>
        </div>

        {
          Object.entries(cityRegions).map(
            ([regionName, regionCities], index) => (
              <div
                class="region-accordion-item"
                style="border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 0.5rem; background: white; overflow: hidden;"
              >
                <button
                  class="region-toggle"
                  style="width: 100%; background: #f8f9fa; border: none; padding: 1rem 1.5rem; text-align: left; font-size: 1.1rem; font-weight: 600; color: #333; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
                  onclick="const content = this.nextElementSibling; const icon = this.querySelector('.toggle-icon'); if (content.style.maxHeight && content.style.maxHeight !== '0px') { content.style.maxHeight = '0'; icon.style.transform = 'rotate(0deg)'; } else { content.style.maxHeight = content.scrollHeight + 'px'; icon.style.transform = 'rotate(180deg)'; }"
                >
                  <span>
                    <i
                      class="fas fa-map-marked-alt"
                      style="color: #35c3e9; margin-right: 0.5rem;"
                    />
                    {regionName} ({regionCities.length} cities)
                  </span>
                  <i
                    class="fas fa-chevron-down toggle-icon"
                    style="color: #666; transition: transform 0.3s ease;"
                  />
                </button>

                <div
                  class="region-content"
                  style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease;"
                >
                  <div
                    class="cities-grid"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem; padding: 1.5rem;"
                  >
                    {regionCities.map((city) => (
                      <a
                        href={`/restoration/${group.slug}/${sub.slug}/${city.slug}`}
                        class="city-link-item"
                        style="text-decoration: none; padding: 0.5rem; color: #555;"
                      >
                        <i
                          class="fas fa-map-pin"
                          style="color: #35c3e9; margin-right: 5px;"
                        />{" "}
                        {city.nombre}
                      </a>
                    ))}
                  </div>
                </div>
              </div>
            ),
          )
        }
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="section faq-section" style="padding-top: 2rem;">
    <div class="container">
      <h2 class="section-title">
        Frequently Asked Questions About {sub.title}
      </h2>
      <FAQ
        customQuestions={[
          {
            question: `How quickly can you respond to ${sub.title.toLowerCase()} emergencies?`,
            answer:
              "We provide 24/7 emergency response and can typically arrive on-site within 60-90 minutes of your call. Our rapid response helps minimize damage and reduces restoration costs.",
          },
          {
            question: "Do you work with insurance companies?",
            answer:
              "Yes, we work directly with insurance companies and adjusters. We provide detailed documentation, photos, and estimates to support your claim and ensure proper coverage.",
          },
        ]}
        client:load
      />
    </div>
  </section>

  <!-- Final CTA -->
  <RestorationCTA
    title="Need Expert Help Now?"
    subtitle="Don't wait - property damage gets worse over time"
    buttonText="Get Emergency Help â†’"
    client:load
  />
</div>
