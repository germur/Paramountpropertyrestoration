---
/**
 * Template unificado para todos los servicios de restoration
 * Reemplaza todos los templates específicos con un sistema modular
 */
import RestoreHero from "../RestoreHero.jsx";
import RestoreProcess from "../RestoreProcess.jsx";
import RestoreServices from "../RestoreServices.jsx";
import RestoreWarnings from "../RestoreWarnings.jsx";
import RestoreFeatures from "../RestoreFeatures.jsx";
import RestoreFAQ from "../RestoreFAQ.jsx";
import RestorationCTA from "../../RestorationCTA.jsx";
import { getSubserviceContent } from "../../../data/subservice-content.js";

const { group, sub } = Astro.props;

// VERIFICACIÓN CRÍTICA: Asegurar que group y sub existen
if (!group || !sub) {
  console.error("UnifiedTemplate: Missing group or sub data", { group, sub });
  throw new Error("UnifiedTemplate requires both group and sub props");
}

// Obtener contenido específico del subservicio
const serviceContent = getSubserviceContent(sub.slug);

// Si no hay contenido específico, usar contenido por defecto
if (!serviceContent) {
  console.warn(`No specific content found for subservice: ${sub.slug}`);
  // Usar contenido básico del sub
  const defaultContent = {
    hero: sub.hero || {
      title: sub.title || "Restoration Services",
      description: sub.short || "Professional restoration services in Florida",
      cta: "Get Help Now",
      badges: []
    },
    process: sub.process || {
      title: "How We Help",
      steps: []
    },
    services: sub.services || [],
    features: sub.whyChooseUs || sub.features || [],
    faqs: sub.faqs || [],
    warnings: sub.warnings || []
  };
  
  // Usar el contenido por defecto
  var finalServiceContent = defaultContent;
} else {
  var finalServiceContent = {
    ...serviceContent,
    features: serviceContent.features || [],
    warnings: serviceContent.warnings || [],
    services: serviceContent.services || [],
    faqs: serviceContent.faqs || []
  };
}

// Configuración del hero usando contenido específico
const heroConfig = {
  title: finalServiceContent.hero.title,
  description: finalServiceContent.hero.description,
  ctaText: finalServiceContent.hero.cta,
  ctaLink: "/contact",
  backgroundImage: `/images/hero${group.template || 'water'}.jpg`,
  badges: finalServiceContent.hero.badges,
  showEmergencyBadge: (group.template || 'water') !== 'mitigation'
};

// Configuración del proceso usando contenido específico
const processConfig = {
  title: finalServiceContent.process.title,
  steps: finalServiceContent.process.steps,
  timeline: "Most inspections completed within 24-48 hours"
};

// Configuración de servicios usando contenido específico
const servicesConfig = {
  title: "What's Included",
  services: finalServiceContent.services,
  layout: "cards"
};

// Configuración de advertencias usando contenido específico
const warningsConfig = {
  title: "Warning Signs You Need Help",
  warnings: finalServiceContent.warnings || [],
  variant: "warning",
  urgencyMessage: "Don't wait - damage spreads quickly and costs increase over time"
};

// Configuración de características usando contenido específico
const featuresConfig = {
  title: "Why Choose Us",
  features: finalServiceContent.features,
  layout: "list"
};

// Configuración de FAQ usando contenido específico
const faqConfig = {
  title: `${sub.title || 'Restoration'} FAQs`,
  faqs: finalServiceContent.faqs,
  maxVisible: 6
};

// CTA final
const finalCta = {
  title: "Need Help Now?",
  subtitle: "Our certified technicians are ready to respond 24/7 to protect your Florida property.",
  buttonText: "Get Help Now",
  buttonLink: "/contact"
};
---

<!-- Hero Section -->
<RestoreHero 
  {...heroConfig}
  client:load 
/>

<!-- Process Overview -->
<RestoreProcess 
  {...processConfig}
  client:load 
/>

<!-- Services/What's Included -->
<RestoreServices 
  {...servicesConfig}
  client:load 
/>

<!-- Why Choose Us Features -->
{serviceContent.features && (
  <RestoreFeatures 
    title="Why Choose Us"
    features={serviceContent.features}
    layout="list"
    client:load 
  />
)}

<!-- FAQ Section -->
<RestoreFAQ 
  {...faqConfig}
  client:load 
/>
<!-- Final CTA -->
<RestorationCTA
  title={finalCta.title}
  subtitle={finalCta.subtitle}
  buttonText={finalCta.buttonText}
  buttonLink={finalCta.buttonLink}
  client:load
/>