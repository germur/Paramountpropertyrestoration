---
/**
 * Template unificado para todos los servicios de restoration
 * Reemplaza todos los templates específicos con un sistema modular
 */
import RestoreHero from "../RestoreHero.jsx";
import RestoreProcess from "../RestoreProcess.jsx";
import RestoreServices from "../RestoreServices.jsx";
import RestoreWarnings from "../RestoreWarnings.jsx";
import RestoreFeatures from "../RestoreFeatures.jsx";
import RestoreFAQ from "../RestoreFAQ.jsx";
import RestorationCTA from "../../RestorationCTA.jsx";
import { getRestorationContent } from "../../../data/restoration-content.js";

const { group, sub } = Astro.props;

// VERIFICACIÓN CRÍTICA: Asegurar que group y sub existen
if (!group || !sub) {
  console.error("UnifiedTemplate: Missing group or sub data", { group, sub });
  throw new Error("UnifiedTemplate requires both group and sub props");
}

// Obtener contenido específico del servicio
const serviceContent = getRestorationContent(group.slug);

// Configuración del hero usando contenido específico
const heroConfig = {
  title: serviceContent.hero.title,
  description: serviceContent.hero.description,
  ctaText: serviceContent.hero.cta,
  ctaLink: "/contact",
  backgroundImage: `/images/hero${group.template || 'water'}.jpg`,
  badges: serviceContent.hero.badges,
  showEmergencyBadge: (group.template || 'water') !== 'mitigation'
};

// Configuración del proceso usando contenido específico
const processConfig = {
  title: serviceContent.process.title,
  steps: serviceContent.process.steps,
  timeline: "Most inspections completed within 24-48 hours"
};

// Configuración de servicios usando contenido específico
const servicesConfig = {
  title: "What's Included",
  services: serviceContent.services,
  layout: "cards"
};

// Configuración de advertencias usando contenido específico
const warningsConfig = {
  title: "Warning Signs You Need Help",
  warnings: serviceContent.warnings,
  variant: "warning",
  urgencyMessage: "Don't wait - damage spreads quickly and costs increase over time"
};

// Configuración de características usando contenido específico
const featuresConfig = {
  title: "Why Choose Us",
  features: serviceContent.features,
  layout: "list"
};

// Configuración de FAQ usando contenido específico
const faqConfig = {
  title: `${sub.title || 'Restoration'} FAQs`,
  faqs: serviceContent.faqs,
  maxVisible: 6
};

// CTA final
const finalCta = {
  title: "Need Help Now?",
  subtitle: "Our certified technicians are ready to respond 24/7 to protect your Florida property.",
  buttonText: "Get Help Now",
  buttonLink: "/contact"
};
---

<!-- Hero Section -->
<RestoreHero 
  {...heroConfig}
  client:load 
/>

<!-- Process Overview -->
<RestoreProcess 
  {...processConfig}
  client:load 
/>

<!-- Services/What's Included -->
<RestoreServices 
  {...servicesConfig}
  client:load 
/>

<!-- Why Choose Us Features -->
{enrichedContent.features && (
  <RestoreFeatures 
    title="Why Choose Us"
    features={enrichedContent.features}
    layout="list"
    client:load 
  />
)}

<!-- FAQ Section -->
<RestoreFAQ 
  {...faqConfig}
  client:load 
/>
<!-- Final CTA -->
<RestorationCTA
  title={finalCta.title}
  subtitle={finalCta.subtitle}
  buttonText={finalCta.buttonText}
  buttonLink={finalCta.buttonLink}
  client:load
/>