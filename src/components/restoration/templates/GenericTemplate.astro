---
/**
 * Template universal para subservicios - VERSIÓN ENRIQUECIDA
 * Genera contenido automáticamente basado en datos básicos usando contentEnricher
 */
import "../../../styles/components/GenericTemplate.css";
import "../../../styles/components/Risks.css";
import "../../../styles/components/Highlights.css";
import FAQ from "../../AcordeonServices.jsx";
import FloridaScenarios from "../../FloridaScenarios.jsx";
import MicroBenefits from "../../MicroBenefits.jsx";
import RegionalCoverage from "../../RegionalCoverage";
import RestorationCTA from "../../RestorationCTA.jsx";
import WhatNotToDo from "../../WhatNotToDo.jsx";
import WhyActingFast from "../../WhyActingFast.jsx";
import WhyEssential from "../../WhyEssential.jsx";
import EmergencySigns from "../../EmergencySigns.jsx";
import StormDamages from "../../StormDamages.jsx";
import WaterSigns from "../../WaterSigns.jsx";
import ServiceCards from "../../ServiceCards.jsx";
import EmergencyIncludes from "../../EmergencyIncludes.jsx";
import { enrichSubserviceContent } from "../../../utils/contentEnricher.js";

const { group, sub } = Astro.props;

// ENRIQUECER CONTENIDO AUTOMÁTICAMENTE
const enrichedSub = enrichSubserviceContent(sub, group);

// HERO ENRIQUECIDO
const heroTitle = enrichedSub.hero.title;
const heroDesc = enrichedSub.hero.description;
const heroCTA = enrichedSub.hero.cta;

// Fallbacks por template para imágenes de hero
const defaultHeroByTemplate = {
  water: "/images/herowater.jpg",
  fire: "/images/herofire.jpg",
  storm: "/images/herostorm.jpg",
  mold: "/images/heromold.jpg",
  mitigation: "/images/heromitigation.jpg",
};
const heroBg =
  enrichedSub.hero.bg ??
  enrichedSub.images?.hero ??
  defaultHeroByTemplate[group.template] ??
  "/images/placeholder-hero.jpg";

// LINK BUILDING (mantenemos la lógica original pero con datos del group completo)
// Necesitamos reconstruir los links ya que no tenemos acceso directo a group.subservices
const links = [
  // Links básicos para cada tipo de servicio
  ...(group.template === 'water' ? [
    { href: '/restoration/water-damage/flood-damage', label: 'Flood Damage' },
    { href: '/restoration/water-damage/leak-repair', label: 'Leak Repair' },
    { href: '/restoration/water-damage/basement-flooding', label: 'Basement Flooding' },
    { href: '/restoration/water-damage/ceiling-water-damage', label: 'Ceiling Water Damage' }
  ] : []),
  ...(group.template === 'fire' ? [
    { href: '/restoration/fire-damage/smoke-damage', label: 'Smoke Damage' },
    { href: '/restoration/fire-damage/soot-cleanup', label: 'Soot Cleanup' },
    { href: '/restoration/fire-damage/fire-damage-repair', label: 'Fire Damage Repair' }
  ] : []),
  ...(group.template === 'mold' ? [
    { href: '/restoration/mold-remediation/black-mold-removal', label: 'Black Mold Removal' },
    { href: '/restoration/mold-remediation/mold-prevention', label: 'Mold Prevention' },
    { href: '/restoration/mold-remediation/mold-testing', label: 'Mold Testing' }
  ] : []),
  ...(group.template === 'storm' ? [
    { href: '/restoration/storm-damage/hurricane-damage', label: 'Hurricane Damage' },
    { href: '/restoration/storm-damage/wind-damage', label: 'Wind Damage' },
    { href: '/restoration/storm-damage/storm-debris-removal', label: 'Storm Debris Removal' }
  ] : []),
  ...(group.template === 'mitigation' ? [
    { href: '/restoration/mitigation-services/water-mitigation', label: 'Water Mitigation' },
    { href: '/restoration/mitigation-services/fire-mitigation', label: 'Fire Mitigation' },
    { href: '/restoration/mitigation-services/mold-mitigation', label: 'Mold Mitigation' }
  ] : [])
].filter(link => link.href !== `/restoration/${group.slug}/${enrichedSub.slug}`);

// FAQ - Usar los generados automáticamente
const customQuestions = enrichedSub.faqs.map((faq, index) => ({
  id: `custom-${index}`,
  question: faq.q,
  answer: faq.a,
}));

const finalCta = {
  title: enrichedSub?.cta?.headline ?? "Need Emergency Help?",
  text: enrichedSub?.cta?.text ?? "Our certified technicians are ready to respond 24/7 to protect your Florida property.",
  cta: enrichedSub?.cta?.button ?? "Get Help Now",
  href: enrichedSub?.cta?.href ?? "/contact",
};
---

<!-- HERO SECTION -->
<section class="hero" style={`--hero-bg: url('${heroBg}')`}>
  <div class="hero__overlay"></div>
  <div class="container hero__inner">
    <h1 class="hero__title">{heroTitle}</h1>
    <p class="hero__desc">{heroDesc}</p>
    <a href="/contact" class="btn btn--primary">{heroCTA}</a>
    
    <!-- Hero Icon Row -->
    <div class="hero__icon-row">
      {enrichedSub.hero.iconRow.map((item) => (
        <div class="hero__icon-item">
          <span class="hero__icon">{item.icon}</span>
          <span class="hero__icon-text">{item.text}</span>
        </div>
      ))}
    </div>
  </div>
</section>

<!-- WHY ESSENTIAL SECTION -->
<WhyEssential whyEssential={enrichedSub.whyEssential} client:load />

<!-- PROCESS SECTION -->
<section class="steps container">
  <h2 class="section__title">{enrichedSub.process.title}</h2>
  <ol class="timeline">
    {enrichedSub.process.steps.map((step) => (
      <li class="timeline__step">
        <div class="timeline__icon">
          <i class={step.icon} />
        </div>
        <div class="timeline__content">
          <h3 class="timeline__title">{step.title}</h3>
          <p class="timeline__text">{step.text}</p>
        </div>
      </li>
    ))}
  </ol>
</section>

<!-- EMERGENCY SIGNS -->
<EmergencySigns emergencySigns={enrichedSub.emergencySigns} client:load />

<!-- HIGHLIGHTS SECTION -->
<section class="highlights container">
  <h2 class="highlights__title">Service Highlights</h2>
  <ul class="highlights__list">
    {enrichedSub.highlights.map((highlight, index) => (
      <li class="highlights__item">
        <span class="highlights__icon">✓</span>
        <span class="highlights__text">{highlight}</span>
      </li>
    ))}
  </ul>
</section>

<!-- RISKS SECTION -->
<section class="risks container">
  <div class="risks__card">
    <h2 class="risks__title">Risks of Delaying Action</h2>
    <ul class="risks__list">
      {enrichedSub.risks.map((risk, index) => (
        <li class="risks__item">
          <span class="risks__icon" aria-hidden="true">🚫</span>
          <span class="risks__text">{risk}</span>
        </li>
      ))}
    </ul>
  </div>
</section>

<!-- MICRO BENEFITS -->
<MicroBenefits benefits={enrichedSub.microBenefits} client:load />

<!-- FLORIDA SCENARIOS -->
<FloridaScenarios scenarios={enrichedSub.floridaScenarios} client:load />

<!-- WHY CHOOSE US -->
<section class="why-choose-us container">
  <h2 class="section__title">Why Choose Paramount Property Restoration</h2>
  <ul class="why-choose-us__list">
    {enrichedSub.whyChooseUs.map((point) => (
      <li class="why-choose-us__item">
        <span class="why-choose-us__icon">✓</span>
        <span class="why-choose-us__text">{point}</span>
      </li>
    ))}
  </ul>
</section>

<!-- RELATED SERVICES -->
<section class="links container">
  <h2 class="section__title">Related Services</h2>
  <ul class="links__grid">
    {links.map((l) => (
      <li>
        <a class="link" href={l.href}>
          {l.label}
        </a>
      </li>
    ))}
  </ul>
</section>

<!-- REGIONAL COVERAGE -->
<RegionalCoverage
  client:load
  title="We Serve All of Florida"
  internalLinks={[]}
  service={group?.slug}
  subcategory={enrichedSub?.slug}
/>

<!-- FAQ -->
<FAQ
  category={group?.template || "general"}
  customQuestions={customQuestions}
  title="Frequently Asked Questions"
  client:load
/>

<!-- FINAL CTA -->
<RestorationCTA
  title={finalCta.title}
  subtitle={finalCta.text}
  buttonText={finalCta.cta}
  buttonLink={finalCta.href}
  client:load
/>