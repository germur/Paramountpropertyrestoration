---
/**
 * Template universal para subservicios - VERSI√ìN UX OPTIMIZADA
 * Reduce scroll infinito con sistema de tabs interactivos
 */
import "../../../styles/components/GenericTemplate.css";
import "../../../styles/components/Risks.css";
import "../../../styles/components/Highlights.css";
import FAQ from "../../AcordeonServices.jsx";
import RegionalCoverage from "../../RegionalCoverage";
import RestorationCTA from "../../RestorationCTA.jsx";

const { group, sub } = Astro.props;

console.log("üìä DATOS RECIBIDOS:", { group: group?.slug, sub: sub?.slug });

// IMPORTACI√ìN Y EJECUCI√ìN DEL ENRICHER
let enrichedSub = sub;
try {
  const { enrichSubserviceContent } = await import("../../../utils/contentEnricher.js");
  console.log("‚úÖ ENRICHER IMPORTADO CORRECTAMENTE");
  
  enrichedSub = enrichSubserviceContent(sub, group);
  console.log("‚ú® CONTENIDO ENRIQUECIDO:", enrichedSub?.hero?.title);
} catch (error) {
  console.error("‚ùå ERROR CON ENRICHER:", error);
  enrichedSub = sub;
}

// HERO ENRIQUECIDO
const heroTitle = enrichedSub.hero?.title || `${sub.title} Services in Florida`;
const heroDesc = enrichedSub.hero?.description || sub.short || `Professional ${sub.title.toLowerCase()} services in Florida.`;
const heroCTA = enrichedSub.hero?.cta || "Get Help Now";

// Fallbacks por template para im√°genes de hero
const defaultHeroByTemplate = {
  water: "/images/herowater.jpg",
  fire: "/images/herofire.jpg",
  storm: "/images/herostorm.jpg",
  mold: "/images/heromold.jpg",
  mitigation: "/images/heromitigation.jpg",
};
const heroBg = defaultHeroByTemplate[group.template] || "/images/placeholder-hero.jpg";

// FAQ para el componente (solo top 4)
const customQuestions = enrichedSub.faqs?.slice(0, 4).map((faq, index) => ({
  id: `custom-${index}`,
  question: faq.q,
  answer: faq.a,
})) || [];

const finalCta = {
  title: "Need Emergency Help?",
  text: "Our certified technicians are ready to respond 24/7 to protect your Florida property.",
  cta: "Get Help Now",
  href: "/contact",
};
---

<!-- HERO SECTION CON TRUST SIGNALS -->
<section class="hero" style={`--hero-bg: url('${heroBg}')`}>
  <div class="hero__overlay"></div>
  <div class="container hero__inner">
    <h1 class="hero__title">{heroTitle}</h1>
    <p class="hero__desc">{heroDesc}</p>
    <div class="hero-actions">
      <a href="/contact" class="btn btn--primary btn--large">{heroCTA}</a>
      <div class="trust-indicators">
        <span class="trust-badge">üìû 24/7 Response</span>
        <span class="trust-badge">üõ°Ô∏è Licensed & Insured</span>
        <span class="trust-badge">‚≠ê 10+ Years Florida</span>
      </div>
    </div>
  </div>
</section>

<!-- PROCESS OVERVIEW (ALWAYS VISIBLE) -->
<section class="process-overview container">
  <h2 class="section__title">How We Help You</h2>
  <div class="process-grid">
    {enrichedSub.process?.steps?.slice(0, 4).map((step, index) => (
      <div class="process-step">
        <div class="process-number">{index + 1}</div>
        <h3 class="process-title">{step.title}</h3>
        <p class="process-text">{step.text}</p>
      </div>
    ))}
  </div>
  <div class="process-cta">
    <p><strong>Timeline:</strong> Most inspections completed within 24-48 hours</p>
    <a href="/contact" class="btn btn--secondary">Get Started Today</a>
  </div>
</section>

<!-- INTERACTIVE CONTENT HUB -->
<section class="content-hub container">
  <h2 class="section__title">Everything You Need to Know</h2>
  
  <div class="tabs-system">
    <!-- Tab Navigation -->
    <div class="tabs-nav" role="tablist">
      <button class="tab-btn active" data-tab="why-need" role="tab" aria-selected="true">
        üö® Why You Need This
      </button>
      <button class="tab-btn" data-tab="what-included" role="tab">
        ‚úÖ What's Included  
      </button>
      <button class="tab-btn" data-tab="florida-specific" role="tab">
        üå¥ Florida Specific
      </button>
      <button class="tab-btn" data-tab="common-concerns" role="tab">
        ‚ùì Common Concerns
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tabs-content">
      
      <!-- TAB 1: Why You Need This -->
      <div class="tab-panel active" id="why-need" role="tabpanel">
        <div class="tab-grid">
          <div class="tab-section">
            <h3>Why Professional Service is Essential</h3>
            <ul class="essential-list">
              {enrichedSub.whyEssential?.steps?.slice(0, 3).map((step) => (
                <li class="essential-item">
                  <span class="essential-icon">‚ö†Ô∏è</span>
                  <span>{step}</span>
                </li>
              ))}
            </ul>
          </div>
          
          <div class="tab-section">
            <h3>Warning Signs You Should Act Now</h3>
            <div class="signs-grid">
              {enrichedSub.emergencySigns?.items?.slice(0, 4).map((sign) => (
                <div class="sign-item">
                  <span class="sign-icon">{sign.icon}</span>
                  <span class="sign-text">{sign.text}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>

      <!-- TAB 2: What's Included -->
      <div class="tab-panel" id="what-included" role="tabpanel">
        <div class="tab-grid">
          <div class="tab-section">
            <h3>Service Highlights</h3>
            <ul class="highlights-compact">
              {enrichedSub.highlights?.slice(0, 6).map((highlight) => (
                <li class="highlight-item">
                  <span class="highlight-check">‚úì</span>
                  <span>{highlight}</span>
                </li>
              ))}
            </ul>
          </div>
          
          <div class="tab-section">
            <h3>Emergency Response Includes</h3>
            <div class="includes-grid">
              {enrichedSub.emergencyIncludes?.items?.map((item) => (
                <div class="include-item">
                  <div class="include-icon">‚ö°</div>
                  <div>
                    <strong>{item.title}</strong>
                    <p>{item.text}</p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>

      <!-- TAB 3: Florida Specific -->
      <div class="tab-panel" id="florida-specific" role="tabpanel">
        <div class="tab-grid">
          <div class="tab-section">
            <h3>Why Florida is Different</h3>
            <ul class="florida-scenarios">
              {enrichedSub.floridaScenarios?.slice(0, 4).map((scenario) => (
                <li class="scenario-item">
                  <span class="scenario-icon">üå¥</span>
                  <span>{scenario}</span>
                </li>
              ))}
            </ul>
          </div>
          
          <div class="tab-section">
            <h3>We Serve All of Florida</h3>
            <div class="regions-compact">
              <div class="region">
                <strong>Central Florida:</strong> Orlando, Tampa, Lakeland
              </div>
              <div class="region">
                <strong>South Florida:</strong> Miami, Fort Lauderdale, Boca Raton
              </div>
              <div class="region">
                <strong>Southwest Florida:</strong> Naples, Fort Myers, Sarasota
              </div>
              <div class="region">
                <strong>+ 50+ more cities</strong>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB 4: Common Concerns -->
      <div class="tab-panel" id="common-concerns" role="tabpanel">
        <div class="tab-grid">
          <div class="tab-section">
            <h3>Frequently Asked Questions</h3>
            <div class="faq-compact">
              {customQuestions.map((faq) => (
                <details class="faq-item">
                  <summary class="faq-question">{faq.question}</summary>
                  <div class="faq-answer">{faq.answer}</div>
                </details>
              ))}
            </div>
          </div>
          
          <div class="tab-section">
            <h3>What NOT to Do</h3>
            <ul class="dont-list">
              {enrichedSub.whatNotToDo?.slice(0, 4).map((item) => (
                <li class="dont-item">
                  <span class="dont-icon">‚ùå</span>
                  <span>{item}</span>
                </li>
              ))}
            </ul>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- SOCIAL PROOF COMPACTA -->
<section class="social-proof">
  <div class="container">
    <div class="proof-grid">
      <div class="proof-item">
        <div class="proof-number">10+</div>
        <div class="proof-text">Years Serving Florida</div>
      </div>
      <div class="proof-item">
        <div class="proof-number">24/7</div>
        <div class="proof-text">Emergency Response</div>
      </div>
      <div class="proof-item">
        <div class="proof-number">100%</div>
        <div class="proof-text">Licensed & Insured</div>
      </div>
      <div class="proof-item">
        <div class="proof-number">1000+</div>
        <div class="proof-text">Properties Restored</div>
      </div>
    </div>
  </div>
</section>

<!-- URGENCY SECTION (CONDENSED) -->
<section class="urgency-section">
  <div class="container">
    <div class="urgency-content">
      <h2 class="urgency-title">‚è∞ Cost of Waiting</h2>
      <div class="risks-compact">
        {enrichedSub.risks?.slice(0, 3).map((risk) => (
          <div class="risk-item">
            <span class="risk-icon">üö´</span>
            <span class="risk-text">{risk}</span>
          </div>
        ))}
      </div>
      <div class="urgency-cta">
        <a href="/contact" class="btn btn--emergency">Get Help Now - Don't Wait</a>
        <p class="urgency-note">Every minute counts. Call now for immediate response.</p>
      </div>
    </div>
  </div>
</section>

<!-- FINAL CTA -->
<RestorationCTA
  title={finalCta.title}
  subtitle={finalCta.text}
  buttonText={finalCta.cta}
  buttonLink={finalCta.href}
  client:load
/>

<!-- JAVASCRIPT FOR TABS -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tabBtns = document.querySelectorAll('.tab-btn');
  const tabPanels = document.querySelectorAll('.tab-panel');
  
  tabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      // Remove active from all
      tabBtns.forEach(b => {
        b.classList.remove('active');
        b.setAttribute('aria-selected', 'false');
      });
      tabPanels.forEach(p => p.classList.remove('active'));
      
      // Add active to clicked
      btn.classList.add('active');
      btn.setAttribute('aria-selected', 'true');
      
      const tabId = btn.getAttribute('data-tab');
      const targetPanel = document.getElementById(tabId);
      if (targetPanel) {
        targetPanel.classList.add('active');
      }
      
      // Analytics tracking (opcional)
      try {
        if (window.gtag) {
          window.gtag('event', 'tab_interaction', {
            'event_category': 'engagement',
            'event_label': tabId
          });
        }
      } catch (e) {
        // Analytics no disponible, continuar normalmente
      }
    });
  });
});
</script>

<!-- CSS STYLES -->
<style>
/* Hero optimizado */
.hero__inner {
  max-width: 800px;
  margin: 0 auto;
  text-align: center;
  padding: 4rem 1rem;
}

.hero-actions {
  margin-top: 2rem;
}

.btn--large {
  padding: 1rem 3rem;
  font-size: 1.25rem;
  margin-bottom: 1.5rem;
}

.trust-indicators {
  display: flex;
  justify-content: center;
  gap: 1rem;
  flex-wrap: wrap;
  margin-top: 1rem;
}

.trust-badge {
  background: rgba(255,255,255,0.9);
  color: #1E293B;
  padding: 0.5rem 1rem;
  border-radius: 25px;
  font-size: 0.875rem;
  font-weight: 600;
}

/* Process Overview */
.process-overview {
  padding: 4rem 1rem;
  background: #F8FAFC;
}

.process-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 2rem;
  margin: 3rem 0;
}

.process-step {
  text-align: center;
  padding: 1.5rem;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.process-number {
  width: 40px;
  height: 40px;
  background: #F59E0B;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  margin: 0 auto 1rem;
}

.process-cta {
  text-align: center;
  margin-top: 2rem;
  padding: 2rem;
  background: white;
  border-radius: 12px;
}

/* Tabs System */
.content-hub {
  padding: 4rem 1rem;
}

.tabs-nav {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-bottom: 3rem;
  flex-wrap: wrap;
}

.tab-btn {
  background: #E2E8F0;
  border: none;
  padding: 1rem 1.5rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
  white-space: nowrap;
}

.tab-btn.active {
  background: #F59E0B;
  color: white;
}

.tab-btn:hover {
  background: #CBD5E1;
}

.tab-btn.active:hover {
  background: #D97706;
}

.tabs-content {
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  overflow: hidden;
}

.tab-panel {
  display: none;
  padding: 2rem;
}

.tab-panel.active {
  display: block;
}

.tab-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
}

.tab-section h3 {
  color: #1E293B;
  margin-bottom: 1.5rem;
  font-size: 1.25rem;
}

/* Lista styles */
.essential-list, .highlights-compact, .florida-scenarios, .dont-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.essential-item, .highlight-item, .scenario-item, .dont-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #E2E8F0;
}

.essential-item:last-child, .highlight-item:last-child, .scenario-item:last-child, .dont-item:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

/* Signs grid */
.signs-grid {
  display: grid;
  gap: 1rem;
}

.sign-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem;
  background: #FEF2F2;
  border-radius: 8px;
  border-left: 4px solid #DC2626;
}

/* Includes grid */
.includes-grid {
  display: grid;
  gap: 1rem;
}

.include-item {
  display: flex;
  gap: 1rem;
  padding: 1rem;
  background: #F0FDF4;
  border-radius: 8px;
  border-left: 4px solid #16A34A;
}

/* FAQ compact */
.faq-compact {
  display: grid;
  gap: 1rem;
}

.faq-item {
  border: 1px solid #E2E8F0;
  border-radius: 8px;
  overflow: hidden;
}

.faq-question {
  padding: 1rem;
  background: #F8FAFC;
  cursor: pointer;
  font-weight: 600;
}

.faq-answer {
  padding: 1rem;
  border-top: 1px solid #E2E8F0;
}

/* Social Proof */
.social-proof {
  background: #1E293B;
  color: white;
  padding: 3rem 0;
}

.proof-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 2rem;
  text-align: center;
}

.proof-number {
  font-size: 2.5rem;
  font-weight: bold;
  color: #F59E0B;
}

.proof-text {
  font-size: 1rem;
  margin-top: 0.5rem;
}

/* Urgency Section */
.urgency-section {
  background: linear-gradient(135deg, #FEF2F2 0%, #FECACA 100%);
  padding: 3rem 0;
}

.urgency-content {
  text-align: center;
  max-width: 800px;
  margin: 0 auto;
}

.urgency-title {
  color: #DC2626;
  font-size: 2rem;
  margin-bottom: 2rem;
}

.risks-compact {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.risk-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem;
  background: white;
  border-radius: 8px;
  text-align: left;
}

.btn--emergency {
  background: #DC2626;
  color: white;
  padding: 1rem 2rem;
  font-size: 1.125rem;
  border-radius: 50px;
  text-decoration: none;
  display: inline-block;
  font-weight: bold;
  margin-bottom: 1rem;
}

.btn--emergency:hover {
  background: #B91C1C;
}

.urgency-note {
  color: #7F1D1D;
  font-style: italic;
  margin: 0;
}

/* Responsive */
@media (max-width: 768px) {
  .tab-grid {
    grid-template-columns: 1fr;
  }
  
  .tabs-nav {
    flex-direction: column;
  }
  
  .tab-btn {
    text-align: center;
  }
  
  .process-grid {
    grid-template-columns: 1fr;
  }
  
  .risks-compact {
    grid-template-columns: 1fr;
  }
}
</style>