---
/**
 * Template universal para subservicios:
 * 1) Hero (h1 + description + cta + bg image)
 * 2) Paso a paso
 * 3) Por quÃ© elegirnos (cards)
 * 4) Link Building
 * 5) FAQ
 * 6) CTA final
 */
import "../../../styles/components/GenericTemplate.css";
import "../../../styles/components/Risks.css";
import "../../../styles/components/Highlights.css";
import FAQ from "../../AcordeonServices.jsx";
import FloridaScenarios from "../../FloridaScenarios.jsx";
import MicroBenefits from "../../MicroBenefits.jsx";
import RegionalCoverage from "../../RegionalCoverage";
import RestorationCTA from "../../RestorationCTA.jsx";
import WhatNotToDo from "../../WhatNotToDo.jsx";
import WhyEssential from "../../WhyEssential.jsx";

const { group, sub } = Astro.props;

// HERO
const heroTitle = sub?.hero?.title ?? sub?.title;
const heroDesc = sub?.hero?.description ?? sub?.short ?? group?.description;
const heroCTA = sub?.hero?.cta ?? "Get Help Now";

// Fallbacks por template (carpetas cortas como usas en /images/water/..)
const defaultHeroByTemplate = {
  water: "/images/herowater.jpg",
  fire: "/images/herofire.jpg",
  storm: "/images/herostorm.jpg",
  mold: "/images/heromold.jpg",
  mitigation: "/images/heromitigation.jpg",
};
const heroBg =
  sub?.hero?.bg ??
  sub?.images?.hero ??
  defaultHeroByTemplate[group?.template] ??
  "/images/placeholder-hero.jpg";

// PASO A PASO
const steps = sub?.steps ?? [
  {
    title: "Assessment",
    text: "We inspect damage and plan the response.",
    icon: "fa-solid fa-clipboard-check",
  },
  {
    title: "Mitigation",
    text: "Stop the cause and protect unaffected areas.",
    icon: "fa-solid fa-shield-halved",
  },
  {
    title: "Drying/Clean",
    text: "Extraction, dehumidification or soot cleanup.",
    icon: "fa-solid fa-wind",
  },
  {
    title: "Repair",
    text: "Structural fixes and finish work.",
    icon: "fa-solid fa-screwdriver-wrench",
  },
];

// Asegura icono por defecto
steps.forEach((s) => {
  if (!s.icon) s.icon = "fa-solid fa-circle-dot";
});

// POR QUÃ‰ ELEGIRNOS
const reasons = sub?.reasons ?? [
  { title: "24/7 Response", text: "Rapid arrival to reduce damage." },
  { title: "Certified Team", text: "IICRC-certified professionals." },
  { title: "Insurance Help", text: "We document and coordinate claims." },
  { title: "Guaranteed Work", text: "Quality workmanship you can trust." },
];

// LINK BUILDING
const autoLinks = (group?.subservices ?? [])
  .filter((s) => s.slug !== sub.slug)
  .map((s) => ({
    href: `/restoration/${group.slug}/${s.slug}`,
    label: s.title,
  }));

const links = sub?.links && sub.links.length > 0 ? sub.links : autoLinks;

// FAQ - Transform data structure for AcordeonServices component
const rawFaqs = sub?.faqs ?? [
  { q: "How fast can you arrive?", a: "Usually within 60â€“90 minutes." },
  { q: "Do you work with insurance?", a: "Yes, we document and coordinate." },
];

// Convert {q, a} format to {question, answer} format for AcordeonServices
const customQuestions = rawFaqs.map((faq, index) => ({
  id: `custom-${index}`,
  question: faq.q,
  answer: faq.a,
}));

const finalCta = {
  title: sub?.cta?.headline ?? "Need help now?",
  text: sub?.cta?.text ?? "",
  cta: sub?.cta?.button ?? "Contact Us",
  href: sub?.cta?.href ?? "/contact",
};
---

<section class="hero" style={`--hero-bg: url('${heroBg}')`}>
  <div class="hero__overlay"></div>
  <div class="container hero__inner">
    <h1 class="hero__title">{heroTitle}</h1>
    <p class="hero__desc">{heroDesc}</p>
    <a href="/contact" class="btn btn--primary">{heroCTA}</a>
    {sub?.hero?.iconRow && (
      <div class="hero__icon-row">
        {sub.hero.iconRow.map((item) => (
          <div class="hero__icon-item">
            <span class="hero__icon">{item.icon}</span>
            <span class="hero__icon-text">{item.text}</span>
          </div>
        ))}
      </div>
    )}
  </div>
</section>

<!-- Why Essential Section -->
{
  sub?.whyEssential && (
    <WhyEssential whyEssential={sub.whyEssential} client:load />
  )
}

{
  sub?.process && (
    <section class="steps container">
      <h2 class="section__title">{sub?.process?.title}</h2>
      <ol class="timeline">
        {sub?.process?.steps.map((s) => (
          <li class="timeline__step">
            <div class="timeline__icon">
              <i class={s.icon} />
            </div>
            <div class="timeline__content">
              <h3 class="timeline__title">{s.title}</h3>
              <p class="timeline__text">{s.text}</p>
            </div>
          </li>
        ))}
      </ol>
    </section>
  )
}

<!-- Highlights Section -->
{
  sub?.highlights && (
    <section class="highlights container">
      <h2 class="highlights__title">Service Highlights</h2>
      <ul class="highlights__list">
        {sub.highlights.map((highlight, index) => (
          <li class="highlights__item">
            <span class="highlights__icon">âœ“</span>
            <span class="highlights__text">{highlight}</span>
          </li>
        ))}
      </ul>
    </section>
  )
}

<!-- Risks Section -->
{
  sub?.risks && (
    <section class="risks container">
      <div class="risks__card">
        <h2 class="risks__title">Risks of Delaying Action</h2>
        <ul class="risks__list">
          {sub.risks.map((risk, index) => (
            <li class="risks__item">
              <span class="risks__icon" aria-hidden="true">
                ðŸš«
              </span>
              <span class="risks__text">{risk}</span>
            </li>
          ))}
        </ul>
      </div>
    </section>
  )
}

{
  sub?.steps && (
    <section class="steps container">
      <h2 class="section__title">Quick Relief â€“ How It Works</h2>
      <ol class="timeline">
        {steps.map((s) => (
          <li class="timeline__step">
            <div class="timeline__icon">
              <i class={s.icon} />
            </div>
            <div class="timeline__content">
              <h3 class="timeline__title">{s.title}</h3>
              <p class="timeline__text">{s.text}</p>
            </div>
          </li>
        ))}
      </ol>
    </section>
  )
}

<!-- Micro Benefits -->
{
  sub?.microBenefits && (
    <MicroBenefits benefits={sub.microBenefits} client:load />
  )
}

<!-- Florida Scenarios -->
{
  sub?.floridaScenarios && (
    <FloridaScenarios scenarios={sub.floridaScenarios} client:load />
  )
}

<!-- Why Choose Us -->
{
  sub?.whyChooseUs && (
    <section class="why-choose-us container">
      <h2 class="section__title">Why Choose Us</h2>
      <ul class="why-choose-us__list">
        {sub.whyChooseUs.map((point) => (
          <li class="why-choose-us__item">
            <span class="why-choose-us__icon">âœ“</span>
            <span class="why-choose-us__text">{point}</span>
          </li>
        ))}
      </ul>
    </section>
  )
}

<!-- What Not To Do -->
{sub?.whatNotToDo && <WhatNotToDo items={sub.whatNotToDo} client:load />}

<section class="links container">
  <h2 class="section__title">Related services</h2>
  <ul class="links__grid">
    {
      links.map((l) => (
        <li>
          <a class="link" href={l.href}>
            {l.label}
          </a>
        </li>
      ))
    }
  </ul>
</section>

<!-- Regional Coverage -->
<RegionalCoverage client:load title="Regional Coverage" internalLinks={[]} />

<FAQ
  category={group?.template || "general"}
  customQuestions={customQuestions}
  title="FAQ"
  client:load
/>

<RestorationCTA
  title={finalCta.title}
  subtitle={finalCta.text}
  buttonText={finalCta.cta}
  buttonLink={finalCta.href}
  client:load
/>
