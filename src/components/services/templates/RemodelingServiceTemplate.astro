---
import { cities } from "../../../data/restoration.js";
import FAQ from "../../AcordeonServices";
import { generateFAQSchema } from "../../EnhancedSchemas.jsx";
import { faqData } from "../../../data/faq.js";
import { getAltText } from "../../../data/image-alt-texts.js";
import { CONTACT_PHONE, BRAND_COLORS } from "../../../config/constants.js";
import "../../../styles/pages/services-template.css";
import "@fortawesome/fontawesome-free/css/all.min.css";

const { group, sub, isHub = false } = Astro.props;

// Calculate FAQ category and generate schema
const faqCategory = group.slug.replace("-remodeling", "");
const faqQuestions = faqData[faqCategory] || faqData.general;
const faqSchema = generateFAQSchema(faqQuestions);

// Enhanced data structure for services template
const getEnhancedServiceData = (groupSlug, subSlug) => {
  const baseData = {
    hero: {
      title: isHub
        ? `${group.name} in Florida`
        : sub?.hero?.title || `${sub.title} Experts in Florida`,
      description: isHub
        ? group.description
        : sub?.hero?.description ||
          `Professional ${sub.title.toLowerCase()} services across Florida. Quality craftsmanship, licensed contractors, and satisfaction guaranteed.`,
      ctaText: isHub ? "Get Free Consultation" : "Start Your Project",
      ctaPhone: CONTACT_PHONE,
      badgeText: isHub
        ? "Licensed & Insured Contractors"
        : "Quality Guaranteed Work",
    },
    services: getServicesForGroup(groupSlug),
    features: getFeaturesForGroup(groupSlug),
    warningSigns: getWarningSignsForGroup(groupSlug),
    process: getProcessForGroup(groupSlug),
  };
  return baseData;
};

// Service-specific configurations
const getServicesForGroup = (groupSlug) => {
  const serviceConfigs = {
    "kitchen-remodeling": [
      {
        name: "Custom Cabinetry",
        icon: "fas fa-cube",
        description: "Premium cabinet design and installation",
      },
      {
        name: "Countertop Installation",
        icon: "fas fa-gem",
        description: "Granite, quartz, and marble surfaces",
      },
      {
        name: "Kitchen Islands",
        icon: "fas fa-th-large",
        description: "Functional island design and construction",
      },
      {
        name: "Appliance Integration",
        icon: "fas fa-blender",
        description: "Modern appliance installation",
      },
      {
        name: "Plumbing & Electrical",
        icon: "fas fa-bolt",
        description: "Complete utility upgrades",
      },
      {
        name: "Lighting Design",
        icon: "fas fa-lightbulb",
        description: "Ambient and task lighting",
      },
    ],
    "bathroom-remodeling": [
      {
        name: "Shower & Tub Installation",
        icon: "fas fa-shower",
        description: "Custom shower and bathtub design",
      },
      {
        name: "Tile & Flooring",
        icon: "fas fa-th",
        description: "Premium tile installation and flooring",
      },
      {
        name: "Vanity & Storage",
        icon: "fas fa-archive",
        description: "Custom vanities and storage solutions",
      },
      {
        name: "Plumbing Fixtures",
        icon: "fas fa-faucet",
        description: "Modern fixtures and fittings",
      },
      {
        name: "Ventilation Systems",
        icon: "fas fa-fan",
        description: "Proper ventilation and humidity control",
      },
      {
        name: "Waterproofing",
        icon: "fas fa-shield-alt",
        description: "Complete waterproofing protection",
      },
    ],
    "bedroom-remodeling": [
      {
        name: "Master Suite Design",
        icon: "fas fa-bed",
        description: "Luxury master bedroom design",
      },
      {
        name: "Closet Organization",
        icon: "fas fa-hanger",
        description: "Custom closet systems and storage",
      },
      {
        name: "Flooring Installation",
        icon: "fas fa-layer-group",
        description: "Hardwood, carpet, and luxury vinyl",
      },
      {
        name: "Built-in Storage",
        icon: "fas fa-cube",
        description: "Custom built-in furniture and storage",
      },
      {
        name: "Lighting & Electrical",
        icon: "fas fa-lightbulb",
        description: "Ambient and accent lighting",
      },
      {
        name: "Window Treatments",
        icon: "fas fa-window-maximize",
        description: "Custom window solutions",
      },
    ],
    "living-dining-remodeling": [
      {
        name: "Open Concept Design",
        icon: "fas fa-expand-arrows-alt",
        description: "Wall removal and space optimization",
      },
      {
        name: "Fireplace Installation",
        icon: "fas fa-fire",
        description: "Custom fireplace design and installation",
      },
      {
        name: "Flooring Systems",
        icon: "fas fa-layer-group",
        description: "Seamless flooring throughout spaces",
      },
      {
        name: "Built-in Entertainment",
        icon: "fas fa-tv",
        description: "Custom entertainment centers",
      },
      {
        name: "Lighting Design",
        icon: "fas fa-lightbulb",
        description: "Layered lighting systems",
      },
      {
        name: "Ceiling Features",
        icon: "fas fa-home",
        description: "Coffered ceilings and architectural details",
      },
    ],
    "home-additions-remodeling": [
      {
        name: "Room Additions",
        icon: "fas fa-plus-square",
        description: "Single and multi-room expansions",
      },
      {
        name: "Second Story Additions",
        icon: "fas fa-building",
        description: "Multi-level home expansions",
      },
      {
        name: "Outdoor Structures",
        icon: "fas fa-leaf",
        description: "Patios, decks, and outdoor rooms",
      },
      {
        name: "ADU Construction",
        icon: "fas fa-home",
        description: "Accessory dwelling units",
      },
      {
        name: "Foundation Work",
        icon: "fas fa-layer-group",
        description: "Structural foundation extensions",
      },
      {
        name: "Roofing Extensions",
        icon: "fas fa-roof",
        description: "Roof modifications and additions",
      },
    ],
  };
  return serviceConfigs[groupSlug] || [];
};

const getFeaturesForGroup = (groupSlug) => {
  const features = {
    "kitchen-remodeling": [
      "Licensed Kitchen Contractors",
      "Custom Cabinet Manufacturing",
      "Premium Material Selection",
      "3D Design Visualization",
      "Code-Compliant Installation",
      "Warranty on All Work",
    ],
    "bathroom-remodeling": [
      "Licensed Bathroom Contractors",
      "Waterproof Installation Guarantee",
      "Premium Fixture Selection",
      "ADA Compliance Available",
      "Mold Prevention Techniques",
      "Complete Project Management",
    ],
    "bedroom-remodeling": [
      "Custom Bedroom Design",
      "Built-in Storage Solutions",
      "Premium Material Selection",
      "Energy-Efficient Solutions",
      "Smart Home Integration",
      "Professional Color Consultation",
    ],
    "living-dining-remodeling": [
      "Open Concept Specialists",
      "Structural Engineering Support",
      "Premium Flooring Installation",
      "Custom Built-in Features",
      "Smart Home Integration",
      "Architectural Detail Work",
    ],
    "home-additions-remodeling": [
      "Licensed General Contractors",
      "Structural Engineering Services",
      "City Permit Management",
      "Architectural Design Support",
      "Foundation to Finish Services",
      "HOA Compliance Assistance",
    ],
  };
  return features[groupSlug] || [];
};

const getWarningSignsForGroup = (groupSlug) => {
  const signs = {
    "kitchen-remodeling": [
      "Outdated cabinets and countertops",
      "Insufficient storage and counter space",
      "Poor lighting and ventilation",
      "Inefficient layout and workflow",
      "Aging appliances and fixtures",
    ],
    "bathroom-remodeling": [
      "Outdated fixtures and finishes",
      "Poor ventilation and moisture issues",
      "Insufficient storage space",
      "Accessibility concerns",
      "Worn tile and grout",
    ],
    "bedroom-remodeling": [
      "Lack of storage space",
      "Poor lighting and ambiance",
      "Outdated flooring and finishes",
      "Inadequate closet organization",
      "Uncomfortable room temperature",
    ],
    "living-dining-remodeling": [
      "Closed-off room layout",
      "Poor traffic flow",
      "Inadequate lighting",
      "Lack of entertaining space",
      "Outdated architectural features",
    ],
    "home-additions-remodeling": [
      "Need for more living space",
      "Growing family requirements",
      "Home office needs",
      "Desire for better property value",
      "Aging in place modifications",
    ],
  };
  return signs[groupSlug] || [];
};

const getProcessForGroup = (groupSlug) => {
  return [
    {
      step: 1,
      title: "Design Consultation",
      description: "Free in-home consultation and 3D design",
      icon: "fas fa-drafting-compass",
    },
    {
      step: 2,
      title: "Material Selection",
      description: "Choose from premium materials and finishes",
      icon: "fas fa-palette",
    },
    {
      step: 3,
      title: "Professional Installation",
      description: "Licensed contractors complete your project",
      icon: "fas fa-tools",
    },
    {
      step: 4,
      title: "Final Walkthrough",
      description: "Quality inspection and project completion",
      icon: "fas fa-check-circle",
    },
  ];
};

const serviceData = getEnhancedServiceData(group.slug, sub?.slug);

// City data for regional display
const getCitiesByRegion = () => {
  const regions = {};
  cities.forEach((city) => {
    if (!regions[city.region]) {
      regions[city.region] = [];
    }
    regions[city.region].push(city);
  });
  return regions;
};

const cityRegions = getCitiesByRegion();

// Get hero image based on service group
const getHeroImage = (slug) => {
  const imageMap = {
    "kitchen-remodeling": "kitchenHero",
    "bathroom-remodeling": "bathroomHero",
    "bedroom-remodeling": "bedroomHero",
    "living-dining-remodeling": "livingDiningHero",
    "home-additions-remodeling": "home-additionsHero",
  };
  return imageMap[slug] || "portadaHome";
};

const heroImage = getHeroImage(group.slug);
const heroImageWebP = `/images/${heroImage}.webp`;
const heroImageJpg = `/images/${heroImage}.webp`;
const heroAlt = getAltText(heroImage);
---

<!-- Inject FAQ Schema -->
<script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />

<div class="unified-service-template">
  <!-- Enhanced Hero Section -->
  <section
    class="hero-section"
    style={`background-image: url('${heroImageJpg}'); min-height: 60vh;`}
    role="img"
    aria-label={heroAlt}
  >
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <div class="hero-badge">
        <i class="fas fa-certificate"></i>
        {serviceData.hero.badgeText}
      </div>
      <h1>{serviceData.hero.title}</h1>
      <p>{serviceData.hero.description}</p>

      <!-- Hero Features -->
      <div class="hero-features">
        <div class="feature-item">
          <i class="fas fa-award"></i>
          Licensed & Insured
        </div>
        <div class="feature-item">
          <i class="fas fa-clock"></i>
          Free Consultations
        </div>
        <div class="feature-item">
          <i class="fas fa-shield-alt"></i>
          Quality Guaranteed
        </div>
      </div>

      <div class="hero-actions">
        <a href="/contact" class="cta-button primary">
          <i class="fas fa-phone"></i>
          {serviceData.hero.ctaText}
        </a>
        <a href="/portfolio" class="cta-button secondary">
          <i class="fas fa-images"></i> See Our Remodeling Projects
        </a>
      </div>
    </div>
  </section>

  <!-- Services Grid Section -->
  <section class="section">
    <div class="container">
      <h2 class="section-title">Our {group.name} Services</h2>
      <div class="services-grid">
        {
          serviceData.services.map((service) => (
            <div class="service-item">
              <div class="service-icon">
                <i class={service.icon} />
              </div>
              <h3>{service.name}</h3>
              <p>{service.description}</p>
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Enhanced Features Section -->
  <section class="section features-section">
    <div class="container">
      <div class="features-grid">
        <div class="features-content">
          <h2>Why Choose Our {group.name}?</h2>
          <ul class="features-list">
            {
              serviceData.features.map((feature) => (
                <li>
                  <span class="feature-check">✓</span>
                  {feature}
                </li>
              ))
            }
          </ul>

          <div class="cta-section">
            <a href="/contact" class="btn-outline">
              Schedule Free Consultation →
            </a>
          </div>
        </div>

        <div class="features-sidebar">
          <!-- Warning Signs Card -->
          <div class="warning-signs-card">
            <h3>Signs You Need {group.name}</h3>
            <ul>
              {serviceData.warningSigns.map((sign) => <li>{sign}</li>)}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Our Process Section - Horizontal Layout -->
  <section class="section process-section">
    <div class="container">
      <h2 class="section-title">Our Process</h2>
      <p class="section-subtitle">
        From consultation to completion, we follow a proven process that ensures
        quality results.
      </p>

      <div class="process-horizontal-grid">
        {
          serviceData.process.map((step) => (
            <div class="process-card">
              <div class="process-icon">
                <i class={step.icon} />
              </div>
              <div class="process-number">{step.step}</div>
              <h3>{step.title}</h3>
              <p>{step.description}</p>
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Service Areas Section - Enhanced like Restoration -->
  <section class="section service-areas-section">
    <div class="container">
      <h2 class="section-title">Serving Florida Communities</h2>
      <p class="section-subtitle">
        We provide {group.name.toLowerCase()} throughout Florida, with local teams
        in every major city to ensure fast response and personalized service.
      </p>

      <!-- Featured Cities - Top 8 Most Important -->
      <div
        class="featured-cities-grid"
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 2.5rem;"
      >
        {
          [
            cityRegions["South Florida"]?.find((c) => c.slug === "miami"),
            cityRegions["Central Florida"]?.find((c) => c.slug === "orlando"),
            cityRegions["Tampa Bay"]?.find((c) => c.slug === "tampa"),
            cityRegions["South Florida"]?.find(
              (c) => c.slug === "fort-lauderdale",
            ),
            cityRegions["Central Florida"]?.find(
              (c) => c.slug === "jacksonville",
            ),
            cityRegions["Southwest Florida"]?.find((c) => c.slug === "naples"),
            cityRegions["Tampa Bay"]?.find((c) => c.slug === "st-petersburg"),
            cityRegions["Central Florida"]?.find(
              (c) => c.slug === "gainesville",
            ),
          ]
            .filter(Boolean)
            .map((city) => (
              <a
                href={`/services/${group.slug}/${city.slug}`}
                style="
            background: linear-gradient(135deg, white 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 2rem 1.5rem;
            text-decoration: none;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(30, 41, 59, 0.06);
          "
                onmouseover={`this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 25px rgba(53, 195, 233, 0.12)'; this.style.borderColor='${BRAND_COLORS.primary}'`}
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(30, 41, 59, 0.06)'; this.style.borderColor='#e2e8f0'"
              >
                <div style="text-align: center;">
                  <div
                    style={`background: ${BRAND_COLORS.primary}; color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem;`}
                  >
                    <i class="fas fa-map-marker-alt" />
                  </div>
                  <h4 style="color: #1e293b; margin-bottom: 0.5rem; font-size: 1.1rem; font-weight: 600;">
                    {city.nombre}
                  </h4>
                  <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 1rem;">
                    {city.condado} County
                  </p>
                  <span
                    style={`
                background: ${BRAND_COLORS.primary}; 
                color: white; 
                padding: 0.6rem 1.2rem; 
                border-radius: 25px; 
                font-size: 0.85rem; 
                font-weight: 600; 
                display: inline-block;
              `}
                  >
                    Get Service Now →
                  </span>
                </div>
              </a>
            ))
        }
      </div>

      <!-- Professional Notice -->
      <div
        class="professional-notice"
        style={`
        margin-top: 3rem;
        background: linear-gradient(135deg, ${BRAND_COLORS.primary} 0%, #2563eb 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        text-align: center;
      `}
      >
        <i
          class="fas fa-tools"
          style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.9;"></i>
        <h3 style="margin-bottom: 0.5rem;">
          Professional {group.name} Available Statewide
        </h3>
        <p style="margin-bottom: 1.5rem; opacity: 0.9;">
          Licensed contractors ready to transform your space. Get your free
          consultation today.
        </p>
        <a
          href="/contact"
          style={`
          background: white;
          color: ${BRAND_COLORS.primary};
          text-decoration: none;
          padding: 0.8rem 2rem;
          border-radius: 25px;
          font-weight: 700;
          font-size: 1rem;
          display: inline-flex;
          align-items: center;
          gap: 0.5rem;
          transition: all 0.3s ease;
        `}
          onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 15px rgba(255,255,255,0.3)'"
          onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'"
        >
          <i class="fas fa-calendar-alt"></i> SCHEDULE FREE CONSULTATION
        </a>
      </div>

      <!-- Regional Accordion for All Cities -->
      <div class="regional-accordion" style="margin-top: 3rem;">
        <div style="text-align: center; margin-bottom: 2rem;">
          <h3 style="color: #333; margin-bottom: 0.5rem;">
            All Florida Service Areas
          </h3>
          <p style="color: #666;">
            Click on any region to see all available cities
          </p>
        </div>

        {
          Object.entries(cityRegions).map(
            ([regionName, regionCities], index) => (
              <div
                class="region-accordion-item"
                style="
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            background: white;
            overflow: hidden;
          "
              >
                <button
                  class="region-toggle"
                  style="
                      width: 100%;
                      background: #f8f9fa;
                      border: none;
                      padding: 1rem 1.5rem;
                      text-align: left;
                      font-size: 1.1rem;
                      font-weight: 600;
                      cursor: pointer;
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      transition: background-color 0.2s ease;
                    "
                  onclick={`toggleRegion('region-${index}')`}
                  onmouseover="this.style.backgroundColor='#e9ecef'"
                  onmouseout="this.style.backgroundColor='#f8f9fa'"
                >
                  <span style="color: #2563eb;">
                    <i
                      class="fas fa-map-marker-alt"
                      style={`margin-right: 0.5rem; color: ${BRAND_COLORS.primary};`}
                    />
                    {regionName} ({(regionCities as any[]).length} Cities)
                  </span>
                  <i
                    class="fas fa-chevron-down region-chevron"
                    id={`chevron-${index}`}
                    style="
                color: #6b7280;
                transition: transform 0.3s ease;
              "
                  />
                </button>

                <div
                  class="region-content"
                  id={`region-${index}`}
                  style="
              max-height: 0;
              overflow: hidden;
              transition: max-height 0.3s ease;
            "
                >
                  <div
                    class="cities-grid"
                    style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 0.75rem;
                padding: 1.5rem;
              "
                  >
                    {(regionCities as any[]).map((city) => (
                      <a
                        href={`/services/${group.slug}/${city.slug}`}
                        style="
                    background: #f8fafc;
                    border: 1px solid #e2e8f0;
                    color: #374151;
                    padding: 0.75rem 1rem;
                    border-radius: 6px;
                    text-decoration: none;
                    font-size: 0.875rem;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                  "
                        onmouseover={`this.style.backgroundColor='${BRAND_COLORS.primary}'; this.style.color='white'; this.style.borderColor='${BRAND_COLORS.primary}'`}
                        onmouseout="this.style.backgroundColor='#f8fafc'; this.style.color='#374151'; this.style.borderColor='#e2e8f0'"
                      >
                        <span>{city.nombre}</span>
                        <i
                          class="fas fa-arrow-right"
                          style="font-size: 0.75rem; opacity: 0.6;"
                        />
                      </a>
                    ))}
                  </div>
                </div>
              </div>
            ),
          )
        }
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="section">
    <div class="container">
      <FAQ
        client:load
        category={faqCategory}
        title={`${group.name} FAQs`}
        serviceName={sub?.title || group.name}
      />
    </div>
  </section>
</div>

<script>
  // Regional accordion functionality
  function toggleRegion(regionId) {
    const content = document.getElementById(regionId);
    const chevron = document.getElementById(
      regionId.replace("region-", "chevron-"),
    );

    if (content.style.maxHeight === "0px" || !content.style.maxHeight) {
      content.style.maxHeight = content.scrollHeight + "px";
      chevron.style.transform = "rotate(180deg)";
    } else {
      content.style.maxHeight = "0px";
      chevron.style.transform = "rotate(0deg)";
    }
  }

  // Make function globally available
  (window as any).toggleRegion = toggleRegion;
</script>
