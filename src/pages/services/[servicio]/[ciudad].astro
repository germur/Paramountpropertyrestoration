---
// src/pages/services/[servicio]/[ciudad].astro
import BaseLayout from "../../../layouts/BaseLayout.astro";
import '../../../styles/pages/[ciudad].css'
import { restorationGroups, cities } from "../../../data/restoration.js";
import SEOHead from "../../../components/SEOHead.jsx";

export async function getStaticPaths() {
  const combinations = [];
  
  // Solo servicios de remodeling (services)
  restorationGroups.forEach(group => {
    // Solo incluir servicios que van en /services/ (remodeling)
    if (group.slug === "remodeling-services" || 
        group.subservices.some(sub => sub.categoria === "remodeling")) {
      group.subservices.forEach(service => {
        cities.forEach(city => {
          combinations.push({
            params: {
              servicio: service.slug,
              ciudad: city.slug,
            },
            props: {
              servicioData: {
                ...service,
                groupSlug: group.slug,
                groupName: group.name,
                template: group.template
              },
              ciudadData: city,
            },
          });
        });
      });
    }
  });

  return combinations;
}

const { servicio, ciudad } = Astro.params;
const { servicioData, ciudadData } = Astro.props;

// Generar contenido din√°mico
const pageTitle = `${servicioData.nombre || servicioData.title} in ${ciudadData.nombre} | Paramount Property Restoration`;
const pageDescription = `Fast, reliable ${(servicioData.nombre || servicioData.title).toLowerCase()} services in ${ciudadData.nombre}, ${ciudadData.region}. Licensed professionals with quality guaranteed work.`;

// Contenido din√°mico
const heroContent = {
  title: `${servicioData.nombre || servicioData.title} in ${ciudadData.nombre}`,
  subtitle: `Fast, reliable ${(servicioData.nombre || servicioData.title).toLowerCase()} services in ${ciudadData.nombre}.`,
  ctaText: `Get Free Quote in ${ciudadData.nombre}`,
};

// Determinar si es servicio de emergencia o remodelaci√≥n
const isEmergencyService = servicioData.categoria === 'restoration';

// Servicios relacionados din√°micos seg√∫n el tipo
const allServices = isEmergencyService ? [
  { name: "Water Damage Restoration", icon: "üíß" },
  { name: "Fire Damage Restoration", icon: "üî•" },
  { name: "Mold Remediation", icon: "üßΩ" },
  { name: "Storm Damage Repair", icon: "‚õàÔ∏è" },
  { name: "Emergency Services", icon: "üö®" },
] : [
  { name: "Bathroom Remodeling", icon: "üõÅ" },
  { name: "Kitchen Remodeling", icon: "üç≥" },
  { name: "Living & Dining", icon: "üõãÔ∏è" },
  { name: "Bedroom Remodeling", icon: "üõèÔ∏è" },
  { name: "Home Additions", icon: "üè°" },
];

const serviceAreaCities = [
  "Weston",
  "Pembroke Pines",
  "Coral Gables",
  "Aventura",
  "Doral",
  "Kendall",
];

// Caracter√≠sticas espec√≠ficas por tipo de servicio
const serviceFeatures = isEmergencyService ? [
  "24/7 emergency response team",
  "Advanced equipment & techniques", 
  "Insurance claim assistance",
  "Licensed & certified technicians"
] : [
  "On-site consultation & custom planning",
  "Code-compliant materials & installation",
  "Fast timelines and real-time updates", 
  "Satisfaction guarantee on every job"
];

const serviceName = servicioData.nombre || servicioData.title;
---

<BaseLayout title={pageTitle} description={pageDescription}>
  {/* SEO para p√°gina de ciudad en /services */}
  <SEOHead
    title={pageTitle}
    description={pageDescription}
    siteUrl="https://paramountpropertyrestoration.com"
    vertical="services"
    service={servicio}
    subservice={null}
    city={ciudad}
    addressLocality={ciudadData.nombre}
    addressRegion={ciudadData.region}
    phone={"+1-786-602-2217"}
    isHub={false}
    businessName="Paramount Property Restoration"
    slot="head"
  />

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="hero-content">
        <!-- Service badges -->
        <div class="service-badges">
          {
            allServices.map((service) => (
              <span
                class="service-badge"
                class:list={[
                  service.name.replace(/[^a-zA-Z]/g, "").toLowerCase().includes(
                    serviceName.replace(/[^a-zA-Z]/g, "").toLowerCase().substring(0, 8)
                  ) && "active",
                ]}
              >
                <span class="badge-icon">{service.icon}</span>
                <span class="badge-text">{service.name}</span>
              </span>
            ))
          }
        </div>

        <!-- Emergency banner for restoration services -->
        {isEmergencyService && (
          <div class="emergency-banner">
            <span class="emergency-icon">üö®</span>
            <span class="emergency-text">24/7 Emergency Response Available</span>
            <span class="emergency-phone">Call Now: (786) 602-2217</span>
          </div>
        )}

        <!-- Main heading -->
        <h1 class="hero-title">
          Professional {serviceName}<br />
          in {ciudadData.nombre}
        </h1>

        <!-- Hero subtitle -->
        <p class="hero-subtitle">
          {heroContent.subtitle}
        </p>

        <!-- CTA Button -->
        <div class="hero-cta">
          <a href="/contact" class="btn-primary">
            {isEmergencyService ? "Get Emergency Help" : "Get Free Quote"} ‚Üí
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Service Overview Section -->
  <section class="section service-overview">
    <div class="container">
      <div class="overview-grid">
        <div class="overview-content">
          <h2>{serviceName} Services You Can Trust</h2>
          <p class="overview-text">
            We deliver {isEmergencyService ? "emergency" : "full-service"} {serviceName.toLowerCase()} in {
              ciudadData.nombre
            } with expert {isEmergencyService ? "technicians" : "contractors"}, {isEmergencyService ? "advanced equipment" : "clean installations"}, and results you can rely on.
          </p>

          <ul class="service-features">
            {serviceFeatures.map((feature) => (
              <li>
                <span class="feature-icon">‚úì</span>
                {feature}
              </li>
            ))}
          </ul>
        </div>

        <div class="overview-sidebar">
          <h3>Serving {ciudadData.nombre} and All of {ciudadData.region}</h3>
          <p>
            We offer {serviceName.toLowerCase()} in {ciudadData.nombre} and
            throughout {ciudadData.region}, including neighborhoods like {
              serviceAreaCities.slice(0, 3).join(", ")
            }, and {serviceAreaCities[3]}.
          </p>
          <a href="/contact" class="btn-outline">
            {isEmergencyService ? "Request Emergency Service" : "Check Availability"} in Your Neighborhood ‚Üí
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Visual Gallery Section -->
  <section class="section gallery-section">
    <div class="container">
      <h2 class="section-title">
        See Our {serviceName} Projects Across Florida
      </h2>
      <p class="section-subtitle">
        We offer {serviceName.toLowerCase()} in {ciudadData.nombre} and throughout
        {ciudadData.region}, including neighborhoods like {
          serviceAreaCities.slice(0, 2).join(" and ")
        }.
      </p>

      <div class="gallery-grid">
        {isEmergencyService ? (
          <>
            <a href="/portfolio" class="gallery-card-link">
              <div class="gallery-item">
                <img
                  src="/images/water-damage-before-after.jpg"
                  alt="Water Damage Restoration Before and After"
                  class="gallery-image"
                />
                <div class="gallery-overlay">
                  <h4>Water Damage Recovery</h4>
                  <p>Complete restoration and drying</p>
                </div>
              </div>
            </a>

            <a href="/portfolio" class="gallery-card-link">
              <div class="gallery-item">
                <img
                  src="/images/fire-damage-restoration.jpg"
                  alt="Fire Damage Restoration"
                  class="gallery-image"
                />
                <div class="gallery-overlay">
                  <h4>Fire Damage Repair</h4>
                  <p>Smoke and structural restoration</p>
                </div>
              </div>
            </a>
          </>
        ) : (
          <>
            <a href="/portfolio" class="gallery-card-link">
              <div class="gallery-item">
                <img
                  src="/images/BanoAntesDespues.jpeg"
                  alt="Bathroom Remodeling Before and After"
                  class="gallery-image"
                />
                <div class="gallery-overlay">
                  <h4>Bathroom Transformation</h4>
                  <p>Luxury finishes and modern fixtures</p>
                </div>
              </div>
            </a>

            <a href="/portfolio" class="gallery-card-link">
              <div class="gallery-item">
                <img
                  src="/images/concinaAntesDespues.jpeg"
                  alt="Kitchen Renovation"
                  class="gallery-image"
                />
                <div class="gallery-overlay">
                  <h4>Kitchen Upgrade</h4>
                  <p>Modern design with custom cabinets</p>
                </div>
              </div>
            </a>
          </>
        )}
      </div>
    </div>
  </section>

  <!-- FAQs Section -->
  <section class="section faq-section">
    <div class="container">
      <h2 class="section-title">
        FAQs About {serviceName} in {ciudadData.nombre}
      </h2>

      <div class="faq-grid">
        <div class="faq-item">
          <h3 class="faq-question">
            {isEmergencyService 
              ? `How quickly can you respond to ${serviceName.toLowerCase()} emergencies in ${ciudadData.nombre}?`
              : `Do I need a permit for ${serviceName.toLowerCase()} in ${ciudadData.nombre}?`
            }
          </h3>
          <p class="faq-answer">
            {isEmergencyService 
              ? `We provide 24/7 emergency response in ${ciudadData.nombre} with typical arrival times of 30-60 minutes for urgent situations.`
              : `Yes, but we handle all permits and city documentation for you. Our team is familiar with ${ciudadData.county} requirements and ensures full compliance.`
            }
          </p>
        </div>

        <div class="faq-item">
          <h3 class="faq-question">
            {isEmergencyService
              ? `Will insurance cover ${serviceName.toLowerCase()} costs?`
              : `How long does a typical ${serviceName.toLowerCase()} project take?`
            }
          </h3>
          <p class="faq-answer">
            {isEmergencyService
              ? `Most insurance policies cover emergency restoration services. We work directly with insurance companies and can help you navigate the claims process.`
              : `Most ${serviceName.toLowerCase()} projects in ${ciudadData.nombre} are completed within 5‚Äì10 business days, depending on the scope and complexity.`
            }
          </p>
        </div>

        <div class="faq-item">
          <h3 class="faq-question">
            What areas of {ciudadData.nombre} do you serve?
          </h3>
          <p class="faq-answer">
            We serve all of {ciudadData.nombre} and surrounding areas in {
              ciudadData.region
            }, including
            {serviceAreaCities.slice(0, 4).join(", ")}, and more.
          </p>
        </div>

        <div class="faq-item">
          <h3 class="faq-question">
            {isEmergencyService
              ? `Are your technicians licensed and certified?`
              : `Do you offer warranties on your ${serviceName.toLowerCase()}?`
            }
          </h3>
          <p class="faq-answer">
            {isEmergencyService
              ? `Yes, all our restoration technicians are fully licensed, certified, and trained in the latest industry standards and safety protocols.`
              : `Yes, all our ${serviceName.toLowerCase()} work comes with comprehensive warranties covering both materials and labor for your peace of mind.`
            }
          </p>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>